name: Deploy to tsuru

on:
  push:
    branches:
      - main      # or master, change if needed

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      # Install tsuru client
      - name: Install tsuru CLI
        run: |
          curl -sL https://tsuru.io/get | bash
          echo "$HOME/bin" >> $GITHUB_PATH

      # Configure tsuru target and token using your secrets
      - name: Configure tsuru
        env:
          TSURU_HOST: ${{ secrets.TSURU_HOST }}
          TSURU_TOKEN: ${{ secrets.TSURU_TOKEN }}
        run: |
          tsuru target-add default "$TSURU_HOST" -s
          tsuru token-set "$TSURU_TOKEN"

      # Deploy the app
      - name: Deploy app to tsuru
        run: |
          tsuru app-deploy -a remote-monitor .

        # Tsuru handles the zipping internally.
        run: |
          tsuru app-deploy -a bioeng-scone-app .
